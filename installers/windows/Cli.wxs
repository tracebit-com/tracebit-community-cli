<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:util="http://wixtoolset.org/schemas/v4/wxs/util">
    <Fragment>
        <ComponentGroup Id="Cli" Directory="INSTALLFOLDER">
            <Component Guid="eb846e26-8f80-4d10-88da-98753b034635">
                <RegistryValue Root="HKCU"
                               Key="Software\Tracebit\Cli"
                               Name="CliInstalled"
                               Type="integer"
                               Value="1"
                               KeyPath="yes" />
                <File Id="tracebit.exe" Source="tracebit.exe" />
                <File Id="tracebit_daemon.exe" Source="tracebit-daemon.exe" />
            </Component>
            <ComponentRef Id="InstallFolderCleanup" />
            <ComponentRef Id="PathEnvironmentVariable" />
            <ComponentRef Id="DaemonAutoStart" />
        </ComponentGroup>
        <util:CloseApplication Id="CloseDaemon"
                               Target="tracebit-daemon.exe"
                               CloseMessage="no"
                               RebootPrompt="no"
                               EndSessionMessage="no"
                               TerminateProcess="1" />
    </Fragment>
    <Fragment>
        <Component Id="PathEnvironmentVariable"
                   Directory="INSTALLFOLDER"
                   Guid="f8e4c2d1-3a7b-4e9f-8c6d-1a2b3c4d5e6f">
            <Environment Id="PATH"
                         Name="PATH"
                         Value="[INSTALLFOLDER]"
                         Permanent="no"
                         Part="last"
                         Action="set"
                         System="no" />
            <RegistryValue Root="HKCU"
                           Key="Software\Tracebit\Cli"
                           Name="PathInstalled"
                           Type="integer"
                           Value="1"
                           KeyPath="yes" />
        </Component>
    </Fragment>
    <Fragment>
        <DirectoryRef Id="INSTALLFOLDER">
            <Component Id="InstallFolderCleanup"
                       Guid="ea88d293-fef2-4e96-82e8-8f68068a3a9e">
                <RegistryValue Root="HKCU"
                               Key="Software\Tracebit\Cli"
                               Name="CleanupInstalled"
                               Type="integer"
                               Value="1"
                               KeyPath="yes" />
                <RemoveFolder Id="RemoveInstallFolderDir"
                              On="uninstall"
                              Directory="INSTALLFOLDER" />
                <RemoveFolder Id="RemoveManufacturerFolder"
                              On="uninstall"
                              Directory="ManufacturerFolder" />
                <RemoveFolder Id="RemovePerUserProgramFilesFolder"
                              On="uninstall"
                              Directory="PerUserProgramFilesFolder" />
            </Component>
    </DirectoryRef>
  </Fragment>
  <Fragment>
        <Component Id="DaemonAutoStart"
                   Directory="INSTALLFOLDER"
                   Guid="a3bcb472-c356-47bc-a62b-77eb28133d87">
            <RegistryValue Root="HKCU"
                           Key="Software\Microsoft\Windows\CurrentVersion\Run"
                           Name="Tracebit"
                           Type="string"
                           Value="&quot;[INSTALLFOLDER]tracebit-daemon.exe&quot;"
                           KeyPath="yes" />
        </Component>
  </Fragment>
</Wix>
